/*! Asteroids 03-01-2014 */
!function(a){a.sample=a.sample||function(a){sampleArray=[],a=a||1;for(var b=0;a>b;b++)sampleArray.push(this[Math.floor(Math.random()*this.length)]);return 1==a?sampleArray[0]:sampleArray},a.normalize=a.normalize||function(){var a=this.mag();return this.map(function(b){return b/a})},a.rotate=a.rotate||function(a){if(2!=this.length)return!1;var b=[];return b.push(Math.cos(a)*this[0]+Math.sin(a)*this[1]),b.push(Math.cos(a)*this[1]-Math.sin(a)*this[0]),b},a.scale=a.scale||function(a){return this.map(function(b){return b*a})},a.add=a.add||function(a){for(var b=[],c=0;c<a.length;c++)this[c]?b.push(this[c]+a[c]):b.push(a[c]);return b},a.subtract=a.subtract||function(a){for(var b=[],c=0;c<a.length;c++)this[c]?b.push(this[c]-a[c]):b.push(-a[c]);return b},a.pow=a.pow||function(a){return this.map(function(b){return Math.pow(b,a)})},a.mag=a.mag||function(){var a=this.map(function(a){return a*a}),b=a.reduce(function(a,b){return a+=b});return Math.sqrt(b)},a.distance=a.distance||function(a){if(this.length!=a.length)return!1;var b=this[0]-a[0],c=this[1]-a[1];return Math.sqrt(b*b+c*c)},a.remove=a.remove||function(a){for(var b=0;b<this.length;b++)if(a===this[b])return this.splice(b,1),this;return!1},a.uniq=a.uniq||function(){for(var a={},b=[],c=0;c<this.length;c++)a[this[c]]||(a[this[c]]=!0,b.push(this[c]));return b},a.nudge=a.nudge||function(){return this.rotate(Math.random()/8*[-1,1].sample())}}(Array.prototype);var Asteroids=this.Asteroids=this.Asteroids||{};!function(a){var b=a.Store=a.Store||{};b.inherits=function(a,b){function c(){}c.prototype=b.prototype,a.prototype=new c},b.randomVel=function(b){var c=Math.random()*a.Asteroid.maxSpeed(b)*[-1,1].sample(),d=Math.random()*a.Asteroid.maxSpeed(b)*[-1,1].sample();return[c,d]},b.randomColor=function(){for(var a="#",b=0;6>b;b++)a+=[1,2,3,4,5,6,7,8,9,"A","B","C","D","E","F"].sample();return a},b.uid=function(a){a=a||32;for(var b=["1","2","3","4","5","6","7","8","9","0","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],c="",d=0;a>d;d++)c+=b.sample();return c},b.assignOnclickToNodeList=function(a,b){for(var c=0;c<a.length;c++)a[c].onclick=b}}(Asteroids);var Asteroids=this.Asteroids=this.Asteroids||{};!function(a){var b=a.Store;MovingObject=a.MovingObject=function(a,c,d){this.radius=d,this.pos=a,this.vel=c,this.id=this.id||b.uid()},MovingObject.prototype.move=function(){this.pos[0]+=this.vel[0],this.pos[1]+=this.vel[1]},MovingObject.prototype.isCollidedWith=function(a){var b=a.radius,c=this.pos.distance(a.pos);return b+this.radius>c?!0:!1},MovingObject.prototype.start=function(){var a=canvasEl.getContext("2d");window.setInterval(function(){as1.move(),as1.draw(a)},100)}}(Asteroids);var Asteroids=this.Asteroids=this.Asteroids||{};!function(a){var b=a.Store,c=a.Asteroid=function(a){this.color=a.color||b.randomColor(),this.health=a.radius,this.id=a.id||null,MovingObject.call(this,a.pos,a.vel,a.radius)};b.inherits(c,MovingObject),c.MAX_SPEED_MULTIPLIER=1,c.RADII=[40,25,10],c.maxSpeed=function(a){return a=a||c.RADII[0],c.MAX_SPEED_MULTIPLIER/5*Math.log(a)},c.randomAsteroid=function(a,b){var d=c.randomAsteroidValues(a,b);return new c(d)},c.randomAsteroidValues=function(a){var d=c.RADII[0];if([!0,!1].sample())var e=Math.random()*a,f=-d;else var e=-d,f=Math.random()*a;var g=b.randomVel(d),h=[e,f],i=b.randomColor(),j=b.uid();return{pos:h,vel:g,radius:d,color:i,id:j}},c.prototype.draw=function(a){a.fillStyle=this.color,a.beginPath(),a.arc(this.pos[0],this.pos[1],this.radius,0,2*Math.PI,!1),a.fill()},c.prototype.explode=function(){var a=c.RADII[c.RADII.indexOf(this.radius)+1];if(!a)return[];for(var d,e,f=[],g=0;3>g;g++){var h=[];h[0]=this.pos[0],h[1]=this.pos[1],d=b.randomVel(a),e=b.randomColor();var i={pos:h,vel:d,radius:a,color:e};f.push(i)}return f},c.prototype.getState=function(){var a={type:"asteroid",radius:this.radius,pos:this.pos,vel:this.vel,id:this.id,health:this.health,color:this.color};return a}}(Asteroids);var Asteroids=this.Asteroids=this.Asteroids||{};!function(a){var b=a.Game=function(a){this.canvas=a,this.ctx=a.getContext("2d"),this.WIDTH=a.width,this.HEIGHT=a.height,this.asteroids=[],this.noExplodeAsteroids=[],this.bullets=[],this.exhaustParticles=[],this.explodingTexts=[],this.ships=[],this.FPS=30,this.repopulationRate=30,this.difficultyRate=.6,this.dropShadowColor="red",this.level=1,this.status="Single Player",this.initialize()};b.prototype.addAsteroids=function(b){for(var c=0;b>c;c++)this.asteroids.push(a.Asteroid.randomAsteroid(this.WIDTH,this.HEIGHT))},b.prototype.addShip=function(){this.ships.push(new a.Ship({pos:[this.WIDTH/2,this.HEIGHT/2]}))},b.prototype.addReadout=function(){var b={game:this};this.readout=new a.Readout(b)},b.prototype.addBackground=function(){this.background=new a.Background(this)},b.prototype.fireShip=function(a){this.bullets.push(a.fire())},b.prototype.powerShip=function(a){a.power(),this.exhaustParticles=this.exhaustParticles.concat(a.releaseExhaust(2))},b.prototype.turnShip=function(a,b,c){a.turn(b,c)},b.prototype.dampenShip=function(a){a.dampen()},b.prototype.draw=function(){var a=this;this.ctx.clearRect(0,0,this.WIDTH,this.HEIGHT),this.background.draw(this.ctx),this.exhaustParticles.forEach(function(b){b.draw(a.ctx)}),this.asteroids.forEach(function(b){b.draw(a.ctx)}),this.bullets.forEach(function(b){b.draw(a.ctx)}),this.ships.forEach(function(b){b.draw(a.ctx)}),this.readout.draw(this.ctx),this.explodingTexts.forEach(function(b){b.draw(a.ctx)})},b.prototype.move=function(){this.asteroids.forEach(function(a){a.move()}),this.ships.forEach(function(a){a.move()}),this.bullets.forEach(function(a){a.move()}),this.exhaustParticles.forEach(function(a){a.move()}),this.background.move()},b.prototype.announce=function(b,c){var c=c||!1,d={game:this,txt:b,independentTimer:c};this.explodingTexts.push(new a.ExplodingText(d))},b.prototype.levelUp=function(){this.level+=1,this.announce("Level "+this.level),this.repopulateAsteroids(),this.modifyDifficulty()},b.prototype.clearOOBObjects=function(){this.clearOOBBullets(),this.clearOOBExhaustParticles()},b.prototype.clearOOBAsteroids=function(){for(var a,b,c,d=0;d<this.asteroids.length;d++)c=this.asteroids[d],a=c.pos[0],b=c.pos[1],(a-c.RADIUS>this.WIDTH||a+c.RADIUS<0||b-c.RADIUS>this.HEIGHT||b+c.RADIUS<0)&&(this.asteroids.splice(d,1),this.addAsteroids(1))},b.prototype.clearOOBBullets=function(){for(var a,b,c,d=0;d<this.bullets.length;d++)a=this.bullets[d],b=a.pos[0],c=a.pos[1],(0>b||0>c||b>this.WIDTH||c>this.HEIGHT)&&this.bullets.splice(d,1)},b.prototype.clearOOBExhaustParticles=function(){for(var a,b,c,d=0;d<this.exhaustParticles.length;d++)a=this.exhaustParticles[d],b=a.pos[0],c=a.pos[1],(0>b||0>c||b>this.WIDTH||c>this.HEIGHT)&&this.exhaustParticles.splice(d,1)},b.prototype.wrapMovingObjects=function(){var a=this,b=[];b=b.concat(a.asteroids).concat(a.ships),b.forEach(function(b){b.pos[0]+b.radius<0&&(b.pos[0]+=a.WIDTH+2*b.radius),b.pos[1]+b.radius<0&&(b.pos[1]+=a.HEIGHT+2*b.radius),b.pos[0]-b.radius>a.WIDTH&&(b.pos[0]-=a.WIDTH+2*b.radius),b.pos[1]-b.radius>a.HEIGHT&&(b.pos[1]-=a.HEIGHT+2*b.radius)})},b.prototype.asteroidCollisionPairs=function(){for(var a=[],b=0;b<this.asteroids.length;b++)for(var c=b+1;c<this.asteroids.length;c++)this.asteroids[b].isCollidedWith(this.asteroids[c])&&a.push([this.asteroids[b],this.asteroids[c]]);return a},b.prototype.asteroidCollisions=function(){return this.asteroidCollisionPairs().uniq},b.prototype.asteroidBulletCollisions=function(){var a=this,b=[];return this.bullets.forEach(function(c){a.asteroids.forEach(function(a){c.isCollidedWithAsteroid(a)&&b.push([a,c])})}),b},b.prototype.depopulateNoExplodeAsteroids=function(){var a=this;this.noExplodeAsteroids.forEach(function(b){var c=a.noExplodeAsteroids.every(function(a){return b===a?!0:!b.isCollidedWith(a)});c&&a.noExplodeAsteroids.remove(b)})},b.prototype.explodeAsteroid=function(b){this.asteroids.remove(b);var c=b.explode(),d=c.map(function(b){return new a.Asteroid(b)});this.noExplodeAsteroids=this.noExplodeAsteroids.concat(d),this.asteroids=this.asteroids.concat(d)},b.prototype.damageAsteroid=function(a,b){a.health-=b},b.prototype.removeBullet=function(a){this.bullets.remove(a)},b.prototype.repopulateAsteroids=function(){this.addAsteroids(5)},b.prototype.modifyDifficulty=function(){this.changeAsteroidSpeed(this.difficultyRate)},b.prototype.changeAsteroidSpeed=function(a){Asteroids.Asteroid.MAX_SPEED_MULTIPLIER+=a},b.prototype.handleCollidingAsteroids=function(a,b){this.damageAsteroid(a,b.radius),this.damageAsteroid(b,a.radius)},b.prototype.handleCollidedShip=function(b,c){game.explodeAsteroid(c),a.Visuals.hit(game.canvas),b.health-=c.radius},b.prototype.handleAsteroidBulletCollisions=function(a,b){this.damageAsteroid(a,b.damage),this.removeBullet(b)},b.prototype.handleExplodedText=function(a){this.explodingTexts.remove(a)},b.prototype.detectCollidingAsteroids=function(){var a=this;this.asteroidCollisionPairs().forEach(function(b){-1===a.noExplodeAsteroids.indexOf(b[0])&&a.handleCollidingAsteroids(b[0],b[1])})},b.prototype.detectHitAsteroids=function(){var a=this;this.hitAsteroids().forEach(function(b){a.handleHitAsteroid(b)})},b.prototype.detectHitShip=function(){for(var a,b,c=this,d=0;d<this.ships.length;d++)for(var e=0;e<this.asteroids.length;e++)a=this.ships[d],b=this.asteroids[e],a.isCollidedWith(b)&&c.handleCollidedShip(a,b)},b.prototype.detectAsteroidBulletCollisions=function(){var a=this;this.asteroidBulletCollisions().forEach(function(b){a.handleAsteroidBulletCollisions(b[0],b[1])})},b.prototype.detectBulletHits=function(){var a=this;this.collidedBullets().forEach(function(b){a.removeBullet(b),a.handleBulletHits(b)})},b.prototype.detectDestroyedObjects=function(){var a=this;this.asteroids.forEach(function(b){b.health<=0&&a.explodeAsteroid(b)})},b.prototype.detectExplodedTexts=function(){var a=this;this.explodingTexts.forEach(function(b){b.alpha<=0&&a.handleExplodedText(b)})},b.prototype.detectLevelChangeReady=function(){0==this.asteroids.length&&this.levelUp()},b.prototype.detect=function(){this.detectCollidingAsteroids(),this.detectAsteroidBulletCollisions(),this.detectHitShip(),this.detectDestroyedObjects(),this.detectExplodedTexts(),this.detectLevelChangeReady()},b.prototype.step=function(){this.clearOOBObjects(),this.depopulateNoExplodeAsteroids(),this.wrapMovingObjects(),this.detect(),this.draw(),this.move()},b.prototype.pause=function(){this.mainTimer?(this.stop(),this.announce("Pause",!0)):(this.start(),this.announce("Resume"))},b.prototype.stop=function(){clearInterval(this.mainTimer),delete this.mainTimer},b.prototype.start=function(){var a=this;this.mainTimer=window.setInterval(function(){a.step()},a.FPS)},b.prototype.initialize=function(){this.addAsteroids(5),this.addShip(),this.addReadout(),this.addBackground(),new a.KeyListener(this),this.start(),this.announce("Welcome!")},b.prototype.setUp=function(){this.asteroids=[],this.noExplodeAsteroids=[],this.addAsteroids(1),this.asteroids[0].vel=[0,0],this.ships[0].pos=[100,100],this.asteroids[0].pos=[250,250]}}(Asteroids);var Asteroids=this.Asteroids=this.Asteroids||{};!function(a){var b=a.GameMP=function(a){this.canvas=a,this.ctx=a.getContext("2d"),this.WIDTH=a.width,this.HEIGHT=a.height,this.ships=[],this.asteroids=[],this.noExplodeAsteroids=[],this.bullets=[],this.exhaustParticles=[],this.explodingTexts=[],this.FPS=30,this.repopulationRate=30,this.difficultyRate=.6,this.bgColor="white",this.dropShadowColor="red",this.level=1,this._counter=0};b.prototype.addAsteroid=function(b){this.asteroids.push(new a.Asteroid(b))},b.prototype.addShip=function(){var b=new a.Ship({pos:[this.WIDTH/2,this.HEIGHT/2]});this.shipID=b.id,this.ships.push(b);var c={id:b.id,pos:b.pos,vel:b.vel,orientation:b.orientation,rotateSpeed:b.rotateSpeed,impulse:b.impulse,dampenRate:b.dampenRate,fireFrequency:b.fireFrequency,health:b.health,damage:b.damage,kineticBullets:b.kineticBullets,bulletWeight:b.bulletWeight};this.socket.emit("addShip",c)},b.prototype.addForeignShip=function(b){this.ships.push(new a.Ship(b)),this.addReadout()},b.prototype.addReadout=function(){var b={game:this};this.readout=new a.Readout(b)},b.prototype.addBackground=function(){this.background=new a.Background(this)},b.prototype.fireForeignShip=function(a){var b=this.get(a),c=b.fire();this.bullets.push(c)},b.prototype.fireShip=function(a){var b=a.fire();this.bullets.push(b);var c={pos:b.pos,vel:b.vel,orientation:b.orientation,shipID:a.id};this.socket.emit("createBullet",c)},b.prototype.powerShip=function(a){a.power(),this.exhaustParticles=this.exhaustParticles.concat(a.releaseExhaust(2)),this.socket.emit("powerShip",{shipID:a.id})},b.prototype.powerForeignShip=function(a){var b=this.get(a);b.power(),this.exhaustParticles=this.exhaustParticles.concat(b.releaseExhaust(2))},b.prototype.turnShip=function(a,b,c){a.turn(b,c);var d={shipID:a.id,dir:b,percentage:c};this.socket.emit("turnShip",d)},b.prototype.turnForeignShip=function(a){var b=this.get(a.shipID),c=a.dir,d=a.percentage;b.turn(c,d)},b.prototype.dampenShip=function(a){a.dampen()},b.prototype.draw=function(){var a=this;this.ctx.clearRect(0,0,this.WIDTH,this.HEIGHT),this.background.draw(this.ctx),this.exhaustParticles.forEach(function(b){b.draw(a.ctx)}),this.asteroids.forEach(function(b){b.draw(a.ctx)}),this.bullets.forEach(function(b){b.draw(a.ctx)}),this.ships.forEach(function(b){b.draw(a.ctx)}),this.readout.draw(this.ctx),this.explodingTexts.forEach(function(b){b.draw(a.ctx)})},b.prototype.move=function(){this.asteroids.forEach(function(a){a.move()}),this.ships.forEach(function(a){a.move()}),this.bullets.forEach(function(a){a.move()}),this.exhaustParticles.forEach(function(a){a.move()}),this.background.move()},b.prototype.announce=function(b,c){var c=c||!1,d={game:this,txt:b,independentTimer:c};this.explodingTexts.push(new a.ExplodingText(d))},b.prototype.levelUp=function(){this.level+=1,this.announce("Level "+this.level)},b.prototype.clearOOBObjects=function(){this.clearOOBBullets(),this.clearOOBExhaustParticles()},b.prototype.clearOOBBullets=function(){for(var a,b,c,d=0;d<this.bullets.length;d++)a=this.bullets[d],b=a.pos[0],c=a.pos[1],(0>b||0>c||b>this.WIDTH||c>this.HEIGHT)&&this.bullets.splice(d,1)},b.prototype.clearOOBExhaustParticles=function(){for(var a,b,c,d=0;d<this.exhaustParticles.length;d++)a=this.exhaustParticles[d],b=a.pos[0],c=a.pos[1],(0>b||0>c||b>this.WIDTH||c>this.HEIGHT)&&this.exhaustParticles.splice(d,1)},b.prototype.wrapMovingObjects=function(){var a=this,b=[];b=b.concat(a.asteroids).concat(a.ships),b.forEach(function(b){b.pos[0]+b.radius<0&&(b.pos[0]+=a.WIDTH+2*b.radius),b.pos[1]+b.radius<0&&(b.pos[1]+=a.HEIGHT+2*b.radius),b.pos[0]-b.radius>a.WIDTH&&(b.pos[0]-=a.WIDTH+2*b.radius),b.pos[1]-b.radius>a.HEIGHT&&(b.pos[1]-=a.HEIGHT+2*b.radius)})},b.prototype.hitAsteroids=function(){var a=this,b=[];return this.bullets.forEach(function(c){a.asteroids.forEach(function(a){c.isCollidedWithAsteroid(a)&&b.push(a)})}),b},b.prototype.collidedBullets=function(){var a=this,b=[];return this.bullets.forEach(function(c){a.asteroids.forEach(function(a){c.isCollidedWithAsteroid(a)&&b.push(c)})}),b},b.prototype.explodeAsteroid=function(a){this.asteroids.remove(a);var b=a.explode();this.noExplodeAsteroids=this.noExplodeAsteroids.concat(b),this.asteroids=this.asteroids.concat(b)},b.prototype.damageAsteroid=function(a,b){a.health-=b},b.prototype.removeBullet=function(a){this.bullets.remove(a)},b.prototype.foreignRemoveBullet=function(a){var b=a.id,c=this.get(b);this.bullets.remove(c)},b.prototype.handleCollidingAsteroids=function(a,b){this.damageAsteroid(a,b.radius),this.damageAsteroid(b,a.radius)},b.prototype.handleCollidedShip=function(b,c){a.Visuals.hit(game.canvas),b.health-=c.radius},b.prototype.handleBulletHits=function(a){this.removeBullet(a)},b.prototype.handleHitAsteroid=function(a){this.damageAsteroid(a,this.ships[0].damage)},b.prototype.handleExplodedText=function(a){this.explodingTexts.remove(a)},b.prototype.detectHitAsteroids=function(){var a=this;this.hitAsteroids().forEach(function(b){a.handleHitAsteroid(b)})},b.prototype.detectHitShip=function(){var a=this;this.asteroids.forEach(function(b){a.ships[0].isCollidedWith(b)&&a.handleCollidedShip(a.ships[0],b)})},b.prototype.detectBulletHits=function(){var a=this;this.collidedBullets().forEach(function(b){a.handleBulletHits(b)})},b.prototype.detectDestroyedObjects=function(){var a=this;this.asteroids.forEach(function(b){b.health<=0&&a.explodeAsteroid(b)})},b.prototype.detectExplodedTexts=function(){var a=this;this.explodingTexts.forEach(function(b){b.alpha<=0&&a.handleExplodedText(b)})},b.prototype.detectSendState=function(){this._counter%3==0&&this.sendState()},b.prototype.detect=function(){this.detectHitAsteroids(),this.detectHitShip(),this.detectBulletHits(),this.detectDestroyedObjects(),this.detectExplodedTexts(),this.detectSendState()},b.prototype.sendState=function(){var a=this.ships[0].getState();this.socket.emit("shipState",a)},b.prototype.get=function(a){var b,c=this.asteroids.concat(this.bullets).concat(this.ships);return c.forEach(function(c){return c.id===a?(b=c,void 0):void 0}),b},b.prototype.clearState=function(){this.asteroids=[],this.ships=[this.ships[0]]},b.prototype.handleFullState=function(a){var b=this,c=a.fullStateArray;this.clearState(),c.forEach(function(a){switch(a.type){case"asteroid":b.handleFullStateAsteroid(a);break;case"bullet":b.handleFullStateBullet(a);break;case"ship":b.handleFullStateShip(a);break;case"level":b.handleFullStateLevel(a)}})},b.prototype.handleFullStateAsteroid=function(b){this.asteroids.push(new a.Asteroid(b))},b.prototype.handleFullStateBullet=function(b){this.bullets.push(new a.Bullet(null,b))},b.prototype.handleFullStateShip=function(b){b.id!=this.shipID&&this.ships.push(new a.Ship(b))},b.prototype.handleFullStateLevel=function(a){this.level=a.level},b.prototype.tic=function(){this._counter+=1},b.prototype.step=function(){this.clearOOBObjects(),this.wrapMovingObjects(),this.detect(),this.draw(),this.move(),this.tic()},b.prototype.pause=function(){this.mainTimer?(this.stop(),this.announce("Pause",!0)):(this.start(),this.announce("Resume"))},b.prototype.stop=function(){clearInterval(this.mainTimer),delete this.mainTimer},b.prototype.start=function(){var a=this;this.mainTimer=window.setInterval(function(){a.step()},a.FPS)},b.prototype.initialize=function(){this.addShip(),this.addReadout(),this.addBackground(),new a.KeyListener(this),this.start(),document.getElementsByTagName("body")[0].bgColor=this.bgColor}}(Asteroids);var Asteroids=this.Asteroids||{};!function(a){var b=a.Store,c=a.Ship=function(c){if(!c)var c={};var d=c.pos||[100,100],e=c.vel||[0,0],f=c.radius||20/3;this.orientation=c.orientation||[0,-1],this.rotateSpeed=c.rotateSpeed||.25,this.impulse=c.impulse||.4,this.dampenRate=c.dampenRate||.95,this.fireFrequency=c.fireFrequency||200,this.health=c.health||40,this.damage=c.damage||15,this.id=c.id||null,this.borderColor=c.borderColor||b.randomColor(),this.fillColor=c.fillColor||b.randomColor(),this.kineticBullets=!0,this.bulletWeight=.5,a.MovingObject.call(this,d,e,f)};b.inherits(c,MovingObject),c.prototype.power=function(){this.vel=this.vel.add(this.orientation.scale(this.impulse))},c.prototype.releaseExhaust=function(b){var c={ship:this},d=[];if(!b)var b=1;for(var e=0;b>e;e++)d.push(new a.ExhaustParticle(c));return d},c.prototype.turn=function(a,b){if("left"===a)var c=1;else var c=-1;this.orientation=this.orientation.rotate(c*this.rotateSpeed*b)},c.prototype.dampen=function(){var a=this.dampenRate;this.vel.mag()<3?(a=.5,this.vel=this.vel.scale(a)):(a=this.dampenRate,this.vel=this.vel.scale(a))},c.prototype.fire=function(){return this.recoil(),new a.Bullet(this)},c.prototype.recoil=function(){this.kineticBullets&&(this.vel=this.vel.subtract(this.orientation.scale(this.bulletWeight)))},c.prototype.draw=function(a,b,c){var d=3*this.radius,e=.3,c=c||this.orientation,f=b||this.pos,g=f.add(c.scale(d/1.5)),h=g.add(c.scale(-d).rotate(e)),i=g.add(c.scale(-d).rotate(-e)),j=g;a.fillStyle=this.fillColor,a.strokeStyle=this.borderColor,a.lineWidth=3,a.beginPath(),a.moveTo(g[0],g[1]),a.lineTo(h[0],h[1]),a.lineTo(i[0],i[1]),a.lineTo(j[0],j[1]),a.closePath(),a.stroke(),a.fill()},c.prototype.getState=function(){var a={type:"ship",radius:this.radius,pos:this.pos,vel:this.vel,id:this.id,orientation:this.orientation,rotateSpeed:this.rotateSpeed,impulse:this.impulse,dampenRate:this.dampenRate,fireFrequency:this.fireFrequency,health:this.health,damage:this.damage,kineticBullets:this.kineticBullets,bulletWeight:this.bulletWeight,borderColor:this.borderColor,fillColor:this.fillColor};return a}}(Asteroids);var Asteroids=this.Asteroids=this.Asteroids||{};!function(a){var b=a.KeyListener=function(a){this.timers={},this.game=a,this.listen()};b.prototype.listen=function(){this.listenUp(),this.listenDown()},b.prototype.listenUp=function(){var a=this;document.onkeyup=function(b){switch(b.keyCode){case 37:case 65:clearInterval(a.timers.left),delete a.timers.left;break;case 39:case 68:clearInterval(a.timers.right),delete a.timers.right;break;case 38:case 87:clearInterval(a.timers.move),delete a.timers.move;break;case 40:case 83:clearInterval(a.timers.dampen),delete a.timers.dampen;break;case 32:clearInterval(a.timers.fire),delete a.timers.fire}}},b.prototype.listenDown=function(){var a=this;document.onkeydown=function(b){switch(b.keyCode){case 65:case 37:a.setTurnTimer("left");break;case 39:case 68:a.setTurnTimer("right");break;case 38:case 87:a.setMoveTimer();break;case 40:case 83:a.setDampenTimer();break;case 32:a.fire();break;case 80:a.game.pause()}}},b.prototype.setTurnTimer=function(a){var b=this;if(!this.timers[a]){var c=0;this.timers[a]=setInterval(function(){c+=.2,c>1&&(c=1),b.game.turnShip(b.game.ships[0],a,c)},b.game.FPS)}},b.prototype.setMoveTimer=function(){var a=this;this.timers.move||(this.timers.move=setInterval(function(){a.game.powerShip(a.game.ships[0])},a.game.FPS))},b.prototype.setDampenTimer=function(){var a=this;this.timers.dampen||(this.timers.dampen=setInterval(function(){a.game.dampenShip(a.game.ships[0])},a.game.FPS))},b.prototype.fire=function(){var a=this;this.timers.fire||(this.game.fireShip(a.game.ships[0]),this.timers.fire=setInterval(function(){a.game.fireShip(a.game.ships[0])},a.game.ships[0].fireFrequency))}}(Asteroids);var Asteroids=this.Asteroids=this.Asteroids||{};!function(a){var b=a.Store,c=a.Bullet=function(a,b){var b=b||{};this.ship=a,this.orientation=b.orientation||a.orientation.slice(0);var c=b.vel||a.vel.add(a.orientation.scale(10)),d=b.pos||a.pos.slice(0),e=b.color||"red";this.damage=b.damage||a.damage,this.id=b.id||null,MovingObject.call(this,d,c,null,e)};b.inherits(c,MovingObject),c.prototype.draw=function(a){var b=this.pos,c=this.pos.add(this.orientation.scale(10));a.beginPath(),a.moveTo(b[0],b[1]),a.lineTo(c[0],c[1]),a.lineWidth=3,a.strokeStyle=this.color,a.stroke()},c.prototype.isCollidedWithAsteroid=function(a){return this.pos.distance(a.pos)<=a.radius?!0:!1},c.prototype.getState=function(){var a={type:"bullet",radius:this.radius,pos:this.pos,vel:this.vel,id:this.id,orientation:this.orientation,damage:this.damage,color:this.color};return a}}(Asteroids);var Asteroids=this.Asteroids=this.Asteroids||{};!function(a){var b=a.Visuals=function(){};b.hit=function(a){a.setAttribute("style","transition: all 0.1s; box-shadow: inset 0 0 30px 30px red;"),setTimeout(function(){a.setAttribute("style","transition: all 0.1s")},100)},b.fadeOut=function(a,b,c){var d=1,e=setInterval(function(){a.setAttribute("style","opacity:"+d+";"),0>=d&&(clearInterval(e),c&&c()),d=Math.round(1e3*(d-b))/1e3},30)}}(Asteroids);var Asteroids=this.Asteroids=this.Asteroids||{};!function(a){var b=(a.Store,a.GameStarter=function(a){this.started=!1,this.initialize(a)});b.prototype.initialize=function(a){switch(a){case"sp":this.startSinglePlayerGame();break;case"hmpg":this.hostMultiPlayerGame();break;case"jmpg":this.notAvailable();break;case"jrmpg":this.joinRandomMultiPlayerGame()}},b.prototype.startSinglePlayerGame=function(){var b=this.createCanvas(),c=new a.Game(b);window.game=c},b.prototype.notAvailable=function(){alert("sorry, not available yet!"),window.location=document.URL},b.prototype.hostMultiPlayerGame=function(){var b=this.createCanvas(),c=new a.GameMP(b);window.game=c;var d=io.connect("/");window.socket=d,c.socket=d,d.on("connect",function(){this.started||(d.emit("hmpg",{width:c.WIDTH,height:c.HEIGHT}),Asteroids.SocketListener.startListening(d,c),this.started=!0,c.initialize())}),d.on("hmpgResponse",function(a){console.log("successfully created room: "+a.gameID)})},b.prototype.joinMultiPlayerGame=function(){},b.prototype.joinRandomMultiPlayerGame=function(){var b=this.createCanvas(),c=new a.GameMP(b);window.game=c;var d=io.connect("/");window.socket=d,c.socket=d,d.on("connect",function(){this.started||(d.emit("jrmpg",{width:c.WIDTH,height:c.HEIGHT}),Asteroids.SocketListener.startListening(d,c),this.started=!0,c.initialize())}),d.on("jrmpgResponse",function(a){console.log("successfully joined room: "+a.gameID)}),d.on("couldntFindGames",function(){console.log("Whoops!  The server couldn't find any games!")})},b.prototype.createSocket=function(a){var b=io.connect("/");b.on("connect",function(){this.started||(this.started=!0,Asteroids.SocketListener.startListening(b),a(b))}),window.socket=b},b.prototype.createCanvas=function(){var a=document.createElement("div");a.id="canvas-wrapper",document.body.appendChild(a);var b=document.createElement("canvas");return b.setAttribute("width","1000"),b.setAttribute("height","500"),a.appendChild(b),b},b.prototype.createGame=function(b){var c=new a.GameMP(b);window.game=c}}(Asteroids),window.onload=function(){var a=document.getElementsByClassName("button");Asteroids.Store.assignOnclickToNodeList(a,function(a){var b=document.getElementById("lower-pane-wrapper"),c=document.getElementsByTagName("footer")[0],d=document.getElementById("main-wrapper");Asteroids.Visuals.fadeOut(c,.3),Asteroids.Visuals.fadeOut(b,.1),setTimeout(function(){Asteroids.Visuals.fadeOut(d,.2,function(){document.getElementById("main-wrapper").remove(),new Asteroids.GameStarter(a.toElement.id)})},300)})};var Asteroids=this.Asteroids=this.Asteroids||{};!function(a){var b=a.Readout=function(a){this.game=a.game};b.prototype.draw=function(a){a.font='15pt "Exo 2", sans-serif',a.fillStyle="white";var b=20,c=35,d=b+c;a.fillText("Level:  "+this.game.level,20,b),a.fillText("Status:  "+this.game.status,20,d);for(var e=0;e<this.game.ships.length;e++){var f=d+c+e*c;a.fillStyle="white",a.fillText("Health:        "+this.game.ships[e].health,20,f),this.game.ships[e].draw(a,[107,f-5],[0,-1])}};var c=a.ExplodingText=function(a){this.game=a.game,this.independentTimer=a.independentTimer,this.txt=a.txt||"default text",this.size=a.size||10,this.growRate=a.growRate||10,this.alpha=a.alpha||1,this.alphaChangeRate=a.alphaChangeRate||.03,this.initialize()};c.prototype.initialize=function(){var a=this;if(this.independentTimer)var b=setInterval(function(){a.alpha<=0?clearInterval(b):a.game.draw()},this.game.FPS)},c.prototype.draw=function(a){a.fillStyle="rgba(255, 255, 255, "+this.alpha+")",a.textAlign="center",a.font=this.size+'pt "Exo 2", sans-serif';var b=this.game.WIDTH/2,c=this.game.HEIGHT/2+this.game.HEIGHT/15;a.fillText(this.txt,b,c),a.textAlign="left",this.size+=this.growRate,this.alpha-=this.alphaChangeRate}}(Asteroids);var Asteroids=this.Asteroids=this.Asteroids||{};!function(a){var b=a.Store,c=a.ExhaustParticle=function(a){this.ship=a.ship,this.pos=this.ship.pos.slice(0),this.radius=a.radius||1,this.vel=this.ship.vel.add(this.ship.orientation.scale(-15).nudge()),this.RGB=["226,72,0","204,24,0","134,2,0","255,119,1"].sample()};b.inherits(c,MovingObject),c.prototype.draw=function(a){var b=this.pos[0],c=this.pos[1],d=a.createRadialGradient(b,c,0,b,c,10);d.addColorStop(0,"rgba("+this.RGB+",0.4)"),d.addColorStop(.1,"rgba("+this.RGB+",.2)"),d.addColorStop(1,"rgba("+this.RGB+",0)"),a.fillStyle=d,a.fillRect(0,0,1e3,500)}}(Asteroids);var Asteroids=this.Asteroids=this.Asteroids||{};!function(a){var b=a.Background=function(a){this.game=a,this.numStars=200,this.stars=[],this.initialize()};b.prototype.initialize=function(){for(var b={height:this.game.HEIGHT,width:this.game.WIDTH},c=0;c<this.numStars;c++)this.stars.push(new a.Star(b))},b.prototype.draw=function(a){this.stars.forEach(function(b){b.draw(a)})},b.prototype.move=function(){this.stars.forEach(function(a){a.move()})}}(Asteroids);var Asteroids=this.Asteroids=this.Asteroids||{};!function(a){var b=a.Store,c=a.Star=function(a){this.height=height=a.height,this.width=width=a.width,this.radius=a.radius||1,this.vel=a.vel||b.randomVel().scale(.02),this.pos=a.pos||[Math.random()*width,Math.random()*height],this.color=["#8A2C1F","blue","grey","grey","grey","grey","grey"].sample()};b.inherits(c,MovingObject),c.prototype.draw=function(a){a.fillStyle=this.color,a.beginPath(),a.arc(this.pos[0],this.pos[1],this.radius,0,2*Math.PI,!1),a.fill()}}(Asteroids);var Asteroids=this.Asteroids=this.Asteroids||{},SocketListener=Asteroids.SocketListener={};!function(a,b){b.startListening=function(a,b){function c(a){d&&console.log(a)}var d=!0;a.on("connectionSuccessful",function(){console.log("socket connected to server "),b.status="connected"}),a.on("reconnecting",function(){console.log("reconnecting to server..."),b.status="reconnecting..."}),a.on("reconnect_failed",function(){conosole.log("Damn, can't reconect to the server!"),b.status="disconnected!  ='("}),a.on("testSuccess",function(){console.log("test received successfully!")}),a.on("test",function(){console.warn("I receieved test!")}),a.on("sessionsStatus",function(a){console.log(a)}),a.on("sessionCreated",function(){console.log("session successfully created")}),a.on("foreignJoin",function(){console.log("Another user has joined the room")}),a.on("addAsteroid",function(a){c("received asteroid"),b.addAsteroid(a)}),a.on("fireShip",function(a){c("firing foreign ship"),b.fireForeignShip(a.shipID)}),a.on("addShip",function(a){c("add foreign ship"),b.addForeignShip(a)}),a.on("removeBullet",function(a){c("remove bullet"),b.foreignRemoveBullet(a)}),a.on("powerForeignShip",function(a){b.powerForeignShip(a.shipID)}),a.on("turnForeignShip",function(a){b.turnForeignShip(a)}),a.on("levelUp",function(){b.levelUp()}),a.on("fullState",function(a){b.handleFullState(a)})}}(Asteroids,SocketListener);